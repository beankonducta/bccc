<html>

<head>
  <link rel="stylesheet" href="players.css">
  <link rel="stylesheet" href="https://use.typekit.net/vlj7tzj.css">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Blue Copper Chess Club</title>
  <link rel="icon" type="image/x-icon" href="Images/favicon.png">
  <meta property="og:image" content="Images/social.png">
  <meta property="og:image:type" content="image/png">
</head>

<body>

  <script>
    var players = [
      { name: "Carter B.", irl_mmr: "1294", web_mmr: "Loading..", win: 8, loss: 2, tie: 0, li_profile: "caboyd", com_profile: "", handle: "caboyd" },
      { name: "Jackson G.", irl_mmr: "1251", web_mmr: "Loading..", win: 5, loss: 2, tie: 0, li_profile: "grassleaf", com_profile: "jacksongraessle", handle: "grassleaf" },
      { name: "Eric C.", irl_mmr: "1221", web_mmr: "Loading..", win: 3, loss: 2, tie: 0, li_profile: "", com_profile: "", handle: "ericc" },
      { name: "Drew V.", irl_mmr: "1199", web_mmr: "Loading..", win: 1, loss: 1, tie: 0, li_profile: "", com_profile: "", handle: "drewv" },
      { name: "Tyler D.", irl_mmr: "1194", web_mmr: "Loading..", win: 3, loss: 4, tie: 0, li_profile: "", com_profile: "", handle: "tylerd" },
      { name: "Sienna D", irl_mmr: "1192", web_mmr: "Loading..", win: 0, loss: 1, tie: 0, li_profile: "", com_profile: "", handle: "siennad" },
      { name: "Matt M.", irl_mmr: "1164", web_mmr: "Loading..", win: 1, loss: 3, tie: 0, li_profile: "", com_profile: "", handle: "mattm" },
      { name: "Patrick A.", irl_mmr: "1162", web_mmr: "Loading..", win: 0, loss: 2, tie: 0, li_profile: "", com_profile: "bnkndcta", handle: "bnkndcta" },
      { name: "Harrison P.", irl_mmr: "1161", web_mmr: "Loading..", win: 0, loss: 4, tie: 0, li_profile: "", com_profile: "", handle: "harrisonp" }
    ];
    function buildProfileText(player) {
      if (player.li_profile !== "" && player.com_profile !== "")
        return `<td><a href="https://lichess.org/@/${player.li_profile}">Lichess</a> / <a href="https://chess.com/member${player.com_profile}">Chess.com</a></td>`;
      else if (player.li_profile !== "")
        return `<td><a href="https://lichess.org/@/${player.li_profile}">Lichess</a></td>`;
      else if (player.com_profile !== "")
        return `<td><a href="https://chess.com/member${player.com_profile}">Chess.com</a></td>`;
      else return `<td>...</td>`;
    }
    function sortPlayers() {
      players.sort((a, b) => {
        if (a.irl_mmr > b.irl_mmr) return -1;
        if (b.irl_mmr > a.irl_mmr) return 1;
        return 0;
      });
    }
    function lichessCall(player) {
      fetch(`https://lichess.org/api/user/${player.li_profile}`)
        .then((r) => r.json())
        .then((data) => {
          document.getElementById(player.handle).innerHTML = data.perfs.classical.rating;
        })
        .catch((e) => document.getElementById(player.handle).innerHTML = "NO DATA");
    }
    function chessDotComCall(player) {
      fetch(`https://api.chess.com/pub/player/${player.com_profile}/stats`)
        .then((r) => r.json())
        .then((data) => {
          document.getElementById(player.handle).innerHTML = data.chess_rapid.last.rating;
        })
        .catch((e) => document.getElementById(player.handle).innerHTML = "NO DATA");
    }
    function addRow(player) {
      var newRow = document.getElementById('player-table').insertRow();
      newRow.innerHTML = `
            <td>${player.name}</td>
            <td>${player.irl_mmr}</td>
            <td id="${player.handle}">${player.web_mmr}</td>
            <td>${player.win}/${player.loss}/${player.tie}</td>
            ${buildProfileText(player)}
        `;
    }
    window.addEventListener('load', () => {
      sortPlayers();
      players.forEach(player => {
        addRow(player);
        if (player.li_profile !== "")
          lichessCall(player);
        else if (player.com_profile !== "")
          chessDotComCall(player);
        else
          chessDotComCall(player); // this will fail but add "no data" to player web mmr
      });
    });
  </script>

  <div class="nav">
    <ul class="nav">
      <img src="Images/webheader.png" width=100%>
      <li><a href="index.html">Information</a></li>
      <li><a href="players.html">Players</a></li>
    </ul>
    <div class="mobile">
      <h2> B.C. Chess Club
        <span class="active">will</span>
        <span class="inactive"> will not</span>
        meet this week (May 19):
      </h2>
      <p> 8 A.M. \ <a href="https://www.bluecopperslc.com/" target="_blank">Blue Copper 2000</a> \ 401 N 300 W </p>
    </div>
  </div>
  </div>

  <div class="content">

    <div class="first-column">
      <h1> Active Players:</h1>
      <p> Ratings are internal and based on in-club games. Calculations by <a
          href="http://www.qa76.net/elo">qa76.net</a>. Records display W/L/D. </p>
      <div class="table">
        <table id="player-table">
          <tr>
            <th>Player</th>
            <th>Rating [IRL]</th>
            <th>Rating [WEB]</th>
            <th>Record</th>
            <th>Profile</th>
          </tr>
        </table>
      </div>
    </div>

    <div class="second-column">
      <h1>Join Us:</h1>
      <h2> B.C. Chess Club </br>
        <span class="active">will</span> &nbsp;&nbsp;
        <span class="inactive"> will not </span></br>
        meet this week (May 12)
      </h2>
      <p>Thursday Mornings, 8 A.M.</br>
        <a href="https://www.bluecopperslc.com/" target="_blank">Blue Copper 2000 </a>
        </br>401 N 300 W
        </br> SLC, UT
      </p>
    </div>

</body>

</html>